<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentification</title>
</head>
<body>
    <h1>Connexion et Inscription</h1>
    <form id="register-form">
        <input type="text" id="register-username" placeholder="Nom d'utilisateur" required>
        <input type="email" id="register-email" placeholder="Email" required>
        <input type="password" id="register-password" placeholder="Mot de passe" required>
        <button type="button" onclick="registerUser()">S'inscrire</button>
    </form>

    <form id="login-form">
        <input type="text" id="login-username" placeholder="Nom d'utilisateur" required>
        <input type="password" id="login-password" placeholder="Mot de passe" required>
        <input type="text" id="login-otp" placeholder="Code OTP (si activé)">
        <button type="button" onclick="loginUser()">Se connecter</button>
    </form>

    <button type="button" onclick="logoutUser()">Se déconnecter</button>
    <button type="button" onclick="activate2FA()">Activer la 2FA</button>
    <button type="button" onclick="confirm2FA()">Confirmer la 2FA</button>

    <script>
        
        async function registerUser() {
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const response = await fetch('http://localhost:8000/api/register/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email, password })
            });
            const data = await response.json();
            alert(response.ok ? 'Inscription réussie!' : `Erreur: ${JSON.stringify(data)}`);
        }

        async function loginUser() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const otp = document.getElementById('login-otp').value;
            const response = await fetch('http://localhost:8000/api/login/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password, otp })
            });
            const data = await response.json();
            alert(response.ok ? 'Connexion réussie!' : `Erreur: ${JSON.stringify(data)}`);
        }

        async function logoutUser() {
            const response = await fetch('http://localhost:8000/api/logout/', {
                method: 'POST',
                credentials: 'include'
            });
            alert(response.ok ? 'Déconnexion réussie!' : `Erreur: ${await response.text()}`);
        }

        async function activate2FA() {
            const response = await fetch('http://localhost:8000/api/activate2FA/', {
                method: 'POST',
                credentials: 'include'
            });
            const data = await response.json();
            alert(response.ok ? `QR Code généré: ${data.provisioning_uri}` : `Erreur: ${data.detail}`);
        }

        async function confirm2FA() {
            const otp = prompt("Entrez votre code OTP:");
            const response = await fetch('http://localhost:8000/api/confirm2FA/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ otp })
            });
            const data = await response.json();
            alert(response.ok ? '2FA activée avec succès!' : `Erreur: ${data.detail}`);
        }
    </script>
</body>
</html>
